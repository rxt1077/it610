apiVersion: apps/v1
kind: StatefulSet
metadata:
    name: mariadb
spec:
    selector:
        matchLabels:
            app: mariadb
    serviceName: mariadb
    replicas: 3
    template:
        metadata:
            labels:
        app: mysql
    spec:
        containers:
            - name: mariadb
                image: mariadb:10.5.7
                env:
                    - name: MYSQL_ALLOW_EMPTY_PASSWORD
                        value: "1"
            ports:
                - name: mariadb
                    containerPort: 3306
            volumeMounts:
                - name: data
                    mountPath: /var/lib/mysql
                    subPath: mysql
        livenessProbe:
            exec:
                command: ["mysqladmin", "ping"]
            initialDelaySeconds: 30
            periodSeconds: 10
            timeoutSeconds: 5
        readinessProbe:
            exec:
                command: ["mysql", "-h", "127.0.0.1", "-e", "SELECT 1"]
            initialDelaySeconds: 5
            periodSeconds: 2
            timeoutSeconds: 1
    volumeClaimTemplates:
        - metadata:
            name: data
        spec:
            accessModes: ["ReadWriteOnce"]
            resources:
                requests:
                    storage: 512M
